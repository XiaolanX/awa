- name: Free Disk Space
      run: |
        sudo rm -rf /usr/share/dotnet
        sudo rm -rf /usr/local/lib/android
        sudo rm -rf /opt/ghc
        sudo rm -rf "/usr/local/share/boost"
        sudo rm -rf /usr/lib/jvm
        df -h

    - name: Install Build Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y bc build-essential flex bison libssl-dev libelf-dev ccache pahole python3 zip git
        
        # 修复：不再克隆整个仓库，只克隆 clang-r487747c 这个特定的提交或只克隆 bin 目录
        # 这里我们直接从安卓镜像下载一个预编译好的独立 Clang 包
        mkdir -p $GITHUB_WORKSPACE/clang
        cd $GITHUB_WORKSPACE/clang
        # 下载一个适配 5.15 内核的较小 Clang 版本
        wget https://android.googlesource.com/platform/prebuilts/clang/host/linux-x86/+archive/refs/heads/main/clang-r487747c.tar.gz
        tar -xzf clang-r487747c.tar.gz
        rm -rf clang-r487747c.tar.gz

    - name: Clone Kernel and Dependencies
      run: |
        # 保持 --depth=1 以节省空间
        git clone https://github.com/OnePlus12R-development/android_kernel_oneplus_sm8550.git --depth=1 -b sixteen-qpr1 kernel/oneplus/sm8550
        git clone https://github.com/OnePlus12R-development/android_kernel_oneplus_sm8550-modules.git --depth=1 -b sixteen-qpr1 kernel/oneplus/sm8550-modules
